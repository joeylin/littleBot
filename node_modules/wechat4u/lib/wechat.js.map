{"version":3,"sources":["../src/wechat.js"],"names":[],"mappings":"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","file":"wechat.js","sourcesContent":["\"use strict\"\nconst EventEmitter = require('events')\nconst request = require('./request.js')\nconst debug = require('debug')('wechat')\nconst FormData = require('form-data')\nconst Pass = require('stream').PassThrough\n\n// Private Method\nconst _getTime = () => new Date().getTime()\nconst _convertEmoji = (s) => {\n  return s.replace(/<span.*?class=\"emoji emoji(.*?)\"><\\/span>/g, (a, b) => {\n    try {\n      let s = null\n      if (b.length == 4 || b.length == 5) {\n        s = ['0x' + b]\n      } else if (b.length == 8) {\n        s = ['0x' + b.slice(0, 4), '0x' + b.slice(4, 8)]\n      } else if (b.length == 10) {\n        s = ['0x' + b.slice(0, 5), '0x' + b.slice(5, 10)]\n      } else {\n        throw new Error('unknown emoji characters')\n      }\n      return String.fromCodePoint.apply(null, s)\n    } catch (err) {\n      debug(b, err)\n      return ' '\n    }\n  })\n}\nconst _contentPrase = (s) => _convertEmoji(s.replace('&lt;', '<').replace('&gt;', '>').replce('<br/>', '\\n'))\n\n// Private\nconst PROP = Symbol()\nconst API = Symbol()\nconst SPECIALUSERS = ['newsapp', 'fmessage', 'filehelper', 'weibo', 'qqmail', 'fmessage', 'tmessage', 'qmessage', 'qqsync', 'floatbottle', 'lbsapp', 'shakeapp', 'medianote', 'qqfriend', 'readerapp', 'blogapp', 'facebookapp', 'masssendapp', 'meishiapp', 'feedsapp', 'voip', 'blogappweixin', 'weixin', 'brandsessionholder', 'weixinreminder', 'wxid_novlwrv3lqwv11', 'gh_22b87fa7cb3c', 'officialaccounts', 'notification_messages', 'wxid_novlwrv3lqwv11', 'gh_22b87fa7cb3c', 'wxitil', 'userexperience_alarm', 'notification_messages']\nconst STATE = {\n  init: 'init',\n  uuid: 'uuid',\n  login: 'login',\n  logout: 'logout'\n}\n\nclass Wechat extends EventEmitter {\n\n  constructor() {\n    super()\n    this[PROP] = {\n      uuid: '',\n      uin: '',\n      sid: '',\n      skey: '',\n      passTicket: '',\n      formateSyncKey: '',\n      webwx_data_ticket: '',\n      deviceId: 'e' + Math.random().toString().substring(2, 17),\n\n      baseRequest: {},\n      syncKey: {},\n    }\n\n    this[API] = {\n      baseUri: '',\n      rediUri: '',\n\n      jsLogin: \"https://login.weixin.qq.com/jslogin\",\n      login: \"https://login.weixin.qq.com/cgi-bin/mmwebwx-bin/login\",\n      synccheck: \"\",\n      webwxdownloadmedia: \"\",\n      webwxuploadmedia: \"\"\n    }\n    this.mediaSend = 0\n    this.state = STATE.init\n\n    this.user = [] // 登陆用户\n    this.memberList = [] // 所有好友\n\n    this.contactList = [] // 个人好友\n    this.groupList = [] // 群\n    this.publicList = [] // 公众账号\n    this.specialList = [] // 特殊账号\n\n    this.request = new request()\n  }\n\n  setProp(key, val) {\n    this[PROP][key] = val\n  }\n\n  getProp(key) {\n    return this[PROP][key]\n  }\n\n  get friendList() {\n    let members = []\n\n    this.groupList.forEach((member) => {\n      members.push({\n        username: member['UserName'],\n        nickname: '群聊: ' + member['NickName'],\n        py: member['RemarkPYQuanPin'] ? member['RemarkPYQuanPin'] : member['PYQuanPin'],\n      })\n    })\n\n    this.contactList.forEach((member) => {\n      members.push({\n        username: member['UserName'],\n        nickname: member['RemarkName'] ? member['RemarkName'] : member['NickName'],\n        py: member['RemarkPYQuanPin'] ? member['RemarkPYQuanPin'] : member['PYQuanPin'],\n      })\n    })\n\n    return members\n  }\n\n  getUUID() {\n    let params = {\n      'appid': 'wx782c26e4c19acffb',\n      'fun': 'new',\n      'lang': 'zh_CN'\n    }\n    return this.request({\n      method: 'POST',\n      url: this[API].jsLogin,\n      params: params\n    }).then(res => {\n      this.emit('uuid')\n      this.state = STATE.uuid\n\n      let re = /window.QRLogin.code = (\\d+); window.QRLogin.uuid = \"(\\S+?)\"/\n      let pm = res.data.match(re)\n      if (!pm) {\n        throw new Error(\"GET UUID ERROR\")\n      }\n      let code = pm[1]\n      let uuid = this[PROP].uuid = pm[2]\n\n      if (code != 200) {\n        throw new Error(\"GET UUID ERROR\")\n      }\n\n      return uuid\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取UUID失败')\n    })\n  }\n\n  checkScan() {\n    let params = {\n      'tip': 1,\n      'uuid': this[PROP].uuid,\n    }\n    return this.request({\n      method: 'GET',\n      url: this[API].login,\n      params: params\n    }).then(res => {\n      let re = /window.code=(\\d+);/\n      let pm = res.data.match(re)\n      let code = pm[1]\n\n      if (code == 201) {\n        return code\n      } else if (code == 408) {\n        throw new Error(code)\n      } else {\n        throw new Error(code)\n      }\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取扫描状态信息失败')\n    })\n  }\n\n  checkLogin() {\n    let params = {\n      'tip': 0,\n      'uuid': this[PROP].uuid,\n    }\n    return this.request({\n      method: 'GET',\n      url: this[API].login,\n      params: params\n    }).then(res => {\n      let re = /window.code=(\\d+);/\n      let pm = res.data.match(re)\n      let code = pm[1]\n\n      if (code == 200) {\n        let re = /window.redirect_uri=\"(\\S+?)\";/\n        let pm = res.data.match(re)\n        this[API].rediUri = pm[1] + '&fun=new'\n        this[API].baseUri = this[API].rediUri.substring(0, this[API].rediUri.lastIndexOf(\"/\"))\n\n        // 接口更新\n        this._APIUpdate(this[API].baseUri)\n\n        return code\n      } else {\n        throw new Error(code)\n      }\n\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取确认登录信息失败')\n    })\n  }\n\n  login() {\n    return this.request({\n      method: 'GET',\n      url: this[API].rediUri\n    }).then(res => {\n      this[PROP].skey = res.data.match(/<skey>(.*)<\\/skey>/)[1]\n      this[PROP].sid = res.data.match(/<wxsid>(.*)<\\/wxsid>/)[1]\n      this[PROP].uin = res.data.match(/<wxuin>(.*)<\\/wxuin>/)[1]\n      this[PROP].passTicket = res.data.match(/<pass_ticket>(.*)<\\/pass_ticket>/)[1]\n      if (res.headers['set-cookie']) {\n        res.headers['set-cookie'].forEach(item => {\n          if (item.indexOf('webwx_data_ticket') != -1)\n            this[PROP].webwx_data_ticket = item.split('; ').shift().split('=').pop()\n        })\n      }\n      this[PROP].baseRequest = {\n        'Uin': parseInt(this[PROP].uin, 10),\n        'Sid': this[PROP].sid,\n        'Skey': this[PROP].skey,\n        'DeviceID': this[PROP].deviceId\n      }\n\n      debug('login Success')\n    }).catch(err => {\n      debug(err)\n      throw new Error('登录失败')\n    })\n  }\n\n  init() {\n    let params = {\n      'pass_ticket': this[PROP].passTicket,\n      'skey': this[PROP].skey,\n      'r': _getTime()\n    }\n    let data = {\n      BaseRequest: this[PROP].baseRequest\n    }\n    return this.request({\n      method: 'POST',\n      url: '/webwxinit',\n      baseURL: this[API].baseUri,\n      params: params,\n      data: data\n    }).then(res => {\n      let data = res.data\n      this[PROP].syncKey = data['SyncKey']\n      this.user = data['User']\n\n      let synckeylist = []\n      for (let e = this[PROP].syncKey['List'], o = 0, n = e.length; n > o; o++)\n        synckeylist.push(e[o]['Key'] + \"_\" + e[o]['Val'])\n      this[PROP].formateSyncKey = synckeylist.join(\"|\")\n\n      debug('wechatInit Success')\n\n      if (data['BaseResponse']['Ret'] !== 0)\n        throw new Error(data['BaseResponse']['Ret'])\n      return true\n    }).catch(err => {\n      debug(err)\n      throw new Error('微信初始化失败')\n    })\n  }\n\n  notifyMobile() {\n    let data = {\n      'BaseRequest': this[PROP].baseRequest,\n      'Code': 3,\n      'FromUserName': this.user['UserName'],\n      'ToUserName': this.user['UserName'],\n      'ClientMsgId': _getTime()\n    }\n    return this.request({\n      method: 'POST',\n      url: '/webwxstatusnotify',\n      baseURL: this[API].baseUri,\n      data: data\n    }).then(res => {\n      let data = res.data\n      debug('notifyMobile Success')\n      if (data['BaseResponse']['Ret'] !== 0)\n        throw new Error(data['BaseResponse']['Ret'])\n      return true\n    }).catch(err => {\n      debug(err)\n      throw new Error('开启状态通知失败')\n    })\n  }\n\n  getContact() {\n    let params = {\n      'lang': 'zh_CN',\n      'pass_ticket': this[PROP].passTicket,\n      'seq': 0,\n      'skey': this[PROP].skey,\n      'r': _getTime()\n    }\n    return this.request({\n      method: 'POST',\n      url: '/webwxgetcontact',\n      baseURL: this[API].baseUri,\n      params: params\n    }).then(res => {\n      let data = res.data\n      this.memberList = data['MemberList']\n\n      for (let member of this.memberList) {\n        member['NickName'] = _convertEmoji(member['NickName'])\n        member['RemarkName'] = _convertEmoji(member['RemarkName'])\n\n        if (member['VerifyFlag'] & 8) {\n          this.publicList.push(member)\n        } else if (SPECIALUSERS.indexOf(member['UserName']) > -1) {\n          this.specialList.push(member)\n        } else if (member['UserName'].indexOf('@@') > -1) {\n          this.groupList.push(member)\n        } else {\n          this.contactList.push(member)\n        }\n      }\n\n      debug(this.memberList.length, ' contacts detected')\n      debug(this.publicList.length, ' publicList')\n      debug(this.specialList.length, ' specialList')\n      debug(this.groupList.length, ' groupList')\n      debug(this.contactList.length, ' contactList')\n\n      return this.memberList\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取通讯录失败')\n    })\n  }\n\n  sync() {\n    let params = {\n      'sid': this[PROP].sid,\n      'skey': this[PROP].skey,\n      'pass_ticket': this[PROP].passTicket\n    }\n    let data = {\n      'BaseRequest': this[PROP].baseRequest,\n      \"SyncKey\": this[PROP].syncKey,\n      'rr': ~_getTime()\n    }\n    return this.request({\n      method: 'POST',\n      url: '/webwxsync',\n      baseURL: this[API].baseUri,\n      params: params,\n      data: data\n    }).then(res => {\n      let data = res.data\n      if (data['BaseResponse']['Ret'] == 0) {\n        this[PROP].syncKey = data['SyncKey']\n        let synckeylist = []\n        for (let e = this[PROP].syncKey['List'], o = 0, n = e.length; n > o; o++)\n          synckeylist.push(e[o]['Key'] + \"_\" + e[o]['Val'])\n        this[PROP].formateSyncKey = synckeylist.join(\"|\")\n      }\n      return data\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取新信息失败')\n    })\n  }\n\n  syncCheck() {\n    let params = {\n      'r': _getTime(),\n      'sid': this[PROP].sid,\n      'uin': this[PROP].uin,\n      'skey': this[PROP].skey,\n      'deviceid': this[PROP].deviceId,\n      'synckey': this[PROP].formateSyncKey\n    }\n    return this.request({\n      method: 'GET',\n      url: this[API].synccheck,\n      params: params,\n    }).then(res => {\n      let re = /window.synccheck={retcode:\"(\\d+)\",selector:\"(\\d+)\"}/\n      let pm = res.data.match(re)\n\n      let retcode = pm[1]\n      let selector = pm[2]\n\n      return {\n        retcode, selector\n      }\n    }).catch(err => {\n      debug(err)\n      throw new Error('同步失败')\n    })\n  }\n\n  handleMsg(data) {\n    debug('Receive ', data['AddMsgList'].length, 'Message')\n\n    data['AddMsgList'].forEach((msg) => {\n      let type = msg['MsgType']\n      let fromUser = this._getUserRemarkName(msg['FromUserName'])\n      let content = msg['Content']\n\n      switch (type) {\n        case 51:\n          debug(' Message: Wechat Init')\n          this.emit('init-message')\n          break\n        case 1:\n          debug(' Text-Message: ', fromUser, ': ', content)\n          this.emit('text-message', msg)\n          break\n        case 3:\n          debug(' Picture-Message: ', fromUser, ': ', content)\n          this.emit('picture-message', msg)\n          break\n        case 34:\n          debug(' Voice-Message: ', fromUser, ': ', content)\n          this.emit('voice-message', msg)\n          break\n      }\n    })\n  }\n\n  syncPolling() {\n    this.syncCheck().then(state => {\n      if (state.retcode == '1100' || state.retcode == '1101') {\n        this.state = STATE.logout\n        debug(state.retcode == '1100' ? '你登出了微信' : '你在其他地方登录了 WEB 版微信')\n        this.emit('logout', state.retcode == '1100' ? '你登出了微信' : '你在其他地方登录了 WEB 版微信')\n      } else if (state.retcode == '0') {\n        if (state.selector == '2') {\n          this.sync().then(data => {\n            this.handleMsg(data)\n            this.syncPolling()\n          }).catch(err => {\n            throw err\n          })\n        } else if (state.selector == '7') {\n          debug('WebSync Mobile Open')\n          this.emit('mobile-open')\n          this.syncPolling()\n        } else if (state.selector == '0') {\n          debug('WebSync Normal')\n          this.syncPolling()\n        } else {\n          // debug('WebSync Others', state.selector)\n          this.syncPolling()\n        }\n      }\n    }).catch(err => {\n      debug(err)\n    })\n  }\n\n  logout() {\n    let params = {\n        redirect: 1,\n        type: 0,\n        skey: this[PROP].skey\n      }\n      // data加上会出错，不加data也能登出\n      // let data = {\n      //   sid: this[PROP].sid,\n      //   uin: this[PROP].uin\n      // }\n    return this.request({\n      method: 'POST',\n      url: '/webwxlogout',\n      baseURL: this[API].baseUri,\n      params: params\n    }).then(res => {\n      return '登出成功'\n    }).catch(err => {\n      debug(err)\n      throw new Error('可能登出成功')\n    })\n  }\n\n  start() {\n    return this.checkScan().then(() => {\n      this.emit('scan')\n      return this.checkLogin()\n    }).then(() => {\n      this.emit('confirm')\n      return this.login()\n    }).then(() => {\n      return this.init()\n    }).then(() => {\n      return this.notifyMobile()\n    }).then(() => {\n      return this.getContact()\n    }).then(memberList => {\n      this.emit('login', memberList)\n      this.state = STATE.login\n      return this.syncPolling()\n    }).catch(err => {\n      this.emit('error', err)\n      return Promise.reject(err)\n    })\n  }\n\n  sendMsg(msg, to) {\n    let params = {\n      'pass_ticket': this[PROP].passTicket\n    }\n    let clientMsgId = _getTime() + '0' + Math.random().toString().substring(2, 5)\n    let data = {\n      'BaseRequest': this[PROP].baseRequest,\n      'Msg': {\n        'Type': 1,\n        'Content': msg,\n        'FromUserName': this.user['UserName'],\n        'ToUserName': to,\n        'LocalID': clientMsgId,\n        'ClientMsgId': clientMsgId\n      }\n    }\n    this.request({\n      method: 'POST',\n      url: '/webwxsendmsg',\n      baseURL: this[API].baseUri,\n      params: params,\n      data: data\n    }).then(res => {\n      let data = res.data\n      if (data['BaseResponse']['Ret'] !== 0)\n        throw new Error(data['BaseResponse']['Ret'])\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送信息失败')\n    })\n  }\n\n  sendImage(to, file, type, size) {\n    return this._uploadMedia(file, type, size).then(mediaId => this._sendImage(mediaId, to)).catch(err => {\n      debug(err)\n      throw new Error('发送图片信息失败')\n    })\n  }\n\n  // file: Buffer, Stream, File, Blob\n  _uploadMedia(file, type, size) {\n    type = type || file.type || ''\n    size = size || file.size || file.length || 0\n    let mediaId = this.mediaSend++\n      let clientMsgId = _getTime() + '0' + Math.random().toString().substring(2, 5)\n\n    let uploadMediaRequest = JSON.stringify({\n      BaseRequest: this[PROP].baseRequest,\n      ClientMediaId: clientMsgId,\n      TotalLen: size,\n      StartPos: 0,\n      DataLen: size,\n      MediaType: 4\n    })\n\n    let form = new FormData()\n    form.append('id', 'WU_FILE_' + mediaId)\n    form.append('name', 'filename')\n    form.append('type', type)\n    form.append('lastModifieDate', new Date().toGMTString())\n    form.append('size', size)\n    form.append('mediatype', 'pic')\n    form.append('uploadmediarequest', uploadMediaRequest)\n    form.append('webwx_data_ticket', this[PROP].webwx_data_ticket)\n    form.append('pass_ticket', encodeURI(this[PROP].passTicket))\n    form.append('filename', file, {\n      filename: 'filename',\n      contentType: type,\n      knownLength: size\n    })\n\n    let params = {\n      f: 'json'\n    }\n\n    let headers = typeof form.getHeaders == 'function' ? form.getHeaders() : null\n\n    return new Promise((resolve, reject) => {\n      if (typeof form.pipe != 'function')\n        resolve(form)\n\n      let pass = new Pass()\n      let buf = []\n      pass.on('data', chunk => {\n        buf.push(chunk)\n      })\n      pass.on('end', () => {\n        let arr = new Uint8Array(Buffer.concat(buf))\n        resolve(arr.buffer)\n      })\n      pass.on('error', err => {\n        reject(err)\n      })\n      form.pipe(pass)\n    }).then(data => {\n      return this.request({\n        url: this[API].webwxuploadmedia,\n        method: 'POST',\n        headers: headers,\n        params: params,\n        data: data\n      })\n    }).then(res => {\n      let mediaId = res.data.MediaId\n      if (!mediaId)\n        throw new Error('MediaId获取失败')\n      return mediaId\n    }).catch(err => {\n      debug(err)\n      throw new Error('上传图片失败')\n    })\n  }\n\n  _sendImage(mediaId, to) {\n    let params = {\n      'pass_ticket': this[PROP].passTicket,\n      'fun': 'async',\n      'f': 'json'\n    }\n    let clientMsgId = _getTime() + '0' + Math.random().toString().substring(2, 5)\n    let data = {\n      'BaseRequest': this[PROP].baseRequest,\n      'Msg': {\n        'Type': 3,\n        'MediaId': mediaId,\n        'FromUserName': this.user['UserName'],\n        'ToUserName': to,\n        'LocalID': clientMsgId,\n        'ClientMsgId': clientMsgId\n      }\n    }\n    return this.request({\n      method: 'POST',\n      url: '/webwxsendmsgimg',\n      baseURL: this[API].baseUri,\n      params: params,\n      data: data\n    }).then(res => {\n      let data = res.data\n      if (data['BaseResponse']['Ret'] != 0)\n        throw new Error(data['BaseResponse']['Ret'])\n      return\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送图片失败')\n    })\n  }\n\n  _APIUpdate(hostUri) {\n    let fileUri = ''\n    let webpushUri = ''\n\n    hostUri.indexOf('wx2.qq.com') > -1 ? (fileUri = 'file2.wx.qq.com', webpushUri = 'webpush2.weixin.qq.com') : hostUri.indexOf('qq.com') > -1 ? (fileUri = 'file.wx.qq.com', webpushUri = 'webpush.weixin.qq.com') : hostUri.indexOf('web1.wechat.com') > -1 ? (fileUri = 'file1.wechat.com', webpushUri = 'webpush1.wechat.com') : hostUri.indexOf('web2.wechat.com') > -1 ? (fileUri = 'file2.wechat.com', webpushUri = 'webpush2.wechat.com') : hostUri.indexOf('wechat.com') > -1 ? (fileUri = 'file.wechat.com', webpushUri = 'webpush.wechat.com') : hostUri.indexOf('web1.wechatapp.com') > -1 ? (fileUri = 'file1.wechatapp.com', webpushUri = 'webpush1.wechatapp.com') : (fileUri = 'file.wechatapp.com', webpushUri = 'webpush.wechatapp.com')\n    this[API].webwxdownloadmedia = 'https://' + fileUri + '/cgi-bin/mmwebwx-bin/webwxgetmedia'\n    this[API].webwxuploadmedia = 'https://' + fileUri + '/cgi-bin/mmwebwx-bin/webwxuploadmedia'\n    this[API].synccheck = 'https://' + webpushUri + '/cgi-bin/mmwebwx-bin/synccheck'\n  }\n\n  _getUserRemarkName(uid) {\n    let name = ''\n\n    this.memberList.forEach((member) => {\n      if (member['UserName'] == uid) {\n        name = member['RemarkName'] ? member['RemarkName'] : member['NickName']\n      }\n    })\n\n    return name\n  }\n\n}\n\nWechat.STATE = STATE\n\nexports = module.exports = Wechat\n"]}